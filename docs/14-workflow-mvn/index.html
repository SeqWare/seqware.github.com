<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<title>SeqWare › Creating New Workflow Bundles and Modules Using Maven Archetypes</title>
<meta content="nanoc 3.6.2" name="generator">
<link href="../../assets/style-v17.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://feeds.feedburner.com/seqware" rel="alternate" title="The SeqWare Blog" type="application/atom+xml">
<script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-34523087-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script><script type="text/javascript">         var disqus_shortname = 'seqware';          (function() {             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;             dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);         })();     </script>
</head>
<body>
<div class="wrapper">
<!-- ***** navigation ***** -->
<div class="nav">
<ol>
<li><a href="../../"><span>Home</span></a></li>
<li><a href="../../blog/"><span>News</span></a></li>
<li><a href="../"><span>Documentation</span></a></li>
<li><a href="../../community/"><span>Community</span></a></li>
<li><a href="../../partners/"><span>Partners</span></a></li>
<li><a href="../../about/"><span>About</span></a></li>
</ol>
</div>
<!-- ***** sidebar ***** -->
<div class="side">
<ol>
<li><a href="../1-introduction/"><span>Introduction to SeqWare</span></a></li>
<li><a href="../2-installation/"><span>Installation</span></a></li>
<li><a href="../3-getting-started/"><span>Getting Started</span></a></li>
<li><a href="../6-pipeline/"><span>SeqWare Pipeline</span></a></li>
<li><a href="../4-metadb/"><span>SeqWare MetaDB</span></a></li>
<li><a href="../5-portal/"><span>SeqWare Portal</span></a></li>
<li><a href="../7-web-service/"><span>SeqWare Web Service</span></a></li>
<li><a href="../8-query-engine/"><span>SeqWare Query Engine</span></a></li>
<li><a href="../9-glossary/"><span>Glossary</span></a></li>
<li><a href="../10-faq/"><span>Frequently Asked Questions</span></a></li>
<li><a href="../11-api/"><span>APIs</span></a></li>
<li><a href="../13-code/"><span>Source Code</span></a></li>
<li><a href="../17-plugins/"><span>Plugins</span></a></li>
<li><a href="../17a-modules/"><span>Modules</span></a></li>
</ol>
</div>
<!-- ***** body ***** -->
<div class="body">
<div class="article">
<div class="header">
<h1>Creating New Workflow Bundles and Modules Using Maven Archetypes</h1>
</div>
<p>The SeqWare workflow archetype and module archetype allow workflow developers to quickly create workflows and modules. The Maven archetypes generate skeletons (of workflows or modules) that contain a simple example program that can be modified to create a new workflow or module. The archetypes also take parameters prior to skeleton generation that allow the name of the workflow or module to be specified and all configuration files to adjusted with respect to these parameters.</p>

<p>The code generated by the archetype contains all the necessary files to generate a complete workflow bundle or module when the <tt>mvn install</tt> command is issued. This command will combine the .ini file and the user created Java file with other external dependencies pulled in by Maven to create a complete workflow bundle or module. This makes the code  generated by the archetype ideal to place under version control. As maintenance changes are made to the Java file or any other aspect of the workflow, these files can be updated and a new workflow reflecting these changes can be generated by re-issuing the  <tt>mvn install</tt> command.</p>

<div class="section" id="installation">
<h2>Installation</h2>

<p>The Maven archetypes are part of SeqWare and are automatically installed when the SeqWare source is checked out and compiled with the <tt>mvn install</tt> command.</p>

<pre><code>$ cd  /home/seqware/seqware-github-development 
$ mvn clean install
</code></pre>

<p>If you are working on a development version and encounter errors, you can skip tests by issuing the following command:</p>

<pre><code>$ mvn install -Dmaven.test.skip=true
</code></pre>

</div>
<div class="section" id="usage">
<h2>Usage</h2>

<p>The rest of this tutorial was performed on a development version of the SeqWare CentOS VM using 0.13.6-SNAPSHOT. Change to a directory where you want to create a new workflow bundle.</p>

<pre><code>$ cd /home/seqware/SeqWare  
$ mkdir maven-bundles 
$ cd maven-bundles 
</code></pre>

<p>Run the command to create a new workflow or module skeleton. The new code will be placed in a child directory.</p>

<pre><code>$ mvn archetype:generate
...
62: local -&gt; com.github.seqware:seqware-archetype-java-workflow (SeqWare Java workflow archetype)
63: local -&gt; com.github.seqware:seqware-archetype-ftl-workflow (SeqWare FTL workflow archetype)
64: local -&gt; com.github.seqware:seqware-archetype-module (SeqWare module archetype)
65: local -&gt; com.github.seqware:seqware-archetype-workflow (SeqWare workflow archetype)
66: local -&gt; com.github.seqware:seqware-archetype-simple-workflow (A very simple SeqWare workflow archetype)
Choose a number or apply filter (format: [groupId:]artifactId, case sensitive contains): 16:
</code></pre>

<p>The numbers used to identify  the archetypes (62 through 66) will vary, so you will need to scan through the list to find the SeqWare archetype you&#8217;re looking for.</p>

<p>62: if you want to write your workflow using Java objects.</p>

<p>63: if you want to write your workflow using FTL.</p>

<div class="section" id="seqware-workflowv2-archetype">
<h3>SeqWare WorkflowV2 Archetype</h3>

<p>In order to work on workflows that use the Java simplified workflow, use 62. Use the following options:</p>

<pre><code>Choose a number or apply filter (format: [groupId:]artifactId, case sensitive contains): 16: 62
Define value for property 'groupId': : net.sf.seqware
Define value for property 'artifactId': : helloworld
Define value for property 'version': 1.0-SNAPSHOT: 1.0
Define value for property 'package': net.sf.seqware:
Define value for property 'workflowDirectoryName': : helloworld
Define value for property 'workflowName': : helloworld
Define value for property 'workflowVersion': : 1.0
Confirm properties configuration:
groupId: net.sf.seqware
artifactId: helloworld
version: 1.0
package: net.sf.seqware
workflowDirectoryName: helloworld
workflowName: helloworld
workflowVersion: 1.0
Y: Y
[INFO] ----------------------------------------------------------------------------
[INFO] Using following parameters for creating project from Archetype: seqware-archetype-java-workflow:0.13.6-SNAPSHOT
[INFO] ----------------------------------------------------------------------------
[INFO] Parameter: groupId, Value: net.sf.seqware
[INFO] Parameter: artifactId, Value: helloworld
[INFO] Parameter: version, Value: 1.0
[INFO] Parameter: package, Value: net.sf.seqware
[INFO] Parameter: packageInPathFormat, Value: net/sf/seqware
[INFO] Parameter: package, Value: net.sf.seqware
[INFO] Parameter: version, Value: 1.0
[INFO] Parameter: workflowName, Value: helloworld
[INFO] Parameter: groupId, Value: net.sf.seqware
[INFO] Parameter: workflowDirectoryName, Value: helloworld
[INFO] Parameter: workflowVersion, Value: 1.0
[INFO] Parameter: artifactId, Value: helloworld
[INFO] project created from Archetype in dir: /home/seqware/SeqWare/maven-bundles/helloworld
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4 minutes 35 seconds
[INFO] Finished at: Fri Nov 23 14:45:24 EST 2012
[INFO] Final Memory: 23M/166M
[INFO] ------------------------------------------------------------------------
</code></pre>

<p>Note the following conventions:</p>

<ul>
<li>groupId
: The workflow belongs to this group. This group id is part of the workflow&#8217;s unique identity.</li>
<li>artifactId
: The specific name of the workflow. Also part of the workflow&#8217;s unique identity. This will also be used as the name of the directory containing all the files associated with this workflow.</li>
<li>version
: The version of this workflow. Again, part of the workflow&#8217;s unique identity. When maintaining the code in the future it will be possible to update this value.</li>
<li>package
: This is a java package name. In the context of creating a workflow this is not used. Just press enter.</li>
<li>workflowDirectoryName
: A unique workflow directory name. No spaces. All lowercase, separated by underscores.</li>
<li>workflowName
: A unique camel case workflow name.</li>
</ul>
<!-- this explicit pre tag should be avoided, but the automatic nanoc formatting does not 
seem to work here --><pre>
    $ cd workflow-helloworld-example
    $ ls
    pom.xml src workflow  workflow.properties
</pre>


<ul>
<li>pom.xml
: A maven project file. Edit this to change the version of the workflow and to add or modify workflow dependencies such as program, modules and data.</li>
<li>workflow
: This directory contains the workflow skeleton. Look in here to modify the workflow .ini, .java files (Java workflow) or workflow.ftl(FTL workflow). The examples of Java and FTL can be found <a href="../15-workflow-examples/">here</a>.</li>
<li>src
: This directory contains the Java client. Look in here to modify the .java files (Java workflow). The examples of Java and FTL can be found <a href="../15-workflow-examples/">here</a>.</li>
<li>workflow.properties
: You can edit the description and workflow names in this file.</li>
</ul>
<div class="section" id="variables">
<h4>Variables</h4>

<p>Automatically Defined</p>

<ul>
<li><p>${date}: a string representing the date the DAX was created, this is always defined so consider this a reserved variable name.</p></li>
<li><p>${random}: a randomly generated string, this is always defined so consider this a reserved variable name.</p></li>
<li><p>${workflow_bundle_dir}: if this workflow is part of a workflow bundle this variable will be defined and points to the path of the root of the directory this workflow bundle has been expanded to.</p></li>
<li><p>${workflow_base_dir}: ${workflow_bundle_dir}/Workflow_Bundle_{workflow_name}/{workflow_version}</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="building-the-workflow">
<h2>Building the Workflow</h2>

<p>The archetype is just a template for the workflow bundle.  You need to use &#8220;mvn install&#8221; to actually build the workflow bundle.</p>

<pre><code>[seqware@seqwarevm maven-bundles]$ cd helloworld/
[seqware@seqwarevm helloworld]$ mvn install
[INFO] Scanning for projects...                                                                                       
[INFO] ------------------------------------------------------------------------                                       
[INFO] Building seqware-workflow                                                                                      
[INFO]    task-segment: [install]                                                                                     
[INFO] ------------------------------------------------------------------------                                       
[INFO] [properties:read-project-properties {execution: properties-maven-plugin-execution}]                            
[debug] execute contextualize                                                                                         
[INFO] [resources:copy-resources {execution: copy-resources}]                                                         
[INFO] Using 'UTF-8' encoding to copy filtered resources.                                                             
[INFO] Copying 3 resources                                                                                            
[debug] execute contextualize                                                                                         
[INFO] [resources:resources {execution: default-resources}]                                                           
[INFO] Using 'UTF-8' encoding to copy filtered resources.    
...
main:
[INFO] Executed tasks
[INFO] [antrun:run {execution: chmod-perl}]
[INFO] Executing tasks

main:
[INFO] Executed tasks
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 26 seconds
[INFO] Finished at: Fri Nov 23 14:48:15 EST 2012
[INFO] Final Memory: 67M/423M
[INFO] ------------------------------------------------------------------------
</code></pre>

<p>At this junction, one would normally want to edit the workflow by modifying the WorkflowClient. However, since this just an example we will proceed onto testing.</p>

</div>
<div class="section" id="testing-the-workflow">
<h2>Testing the Workflow</h2>

<p>You can first get an idea of what parameters are needed by displaying the help message</p>

<pre><code>[seqware@seqwarevm maven-bundles]$ java -jar helloworld/target/Workflow_Bundle_helloworld_1.0_SeqWare_0.13.6-SNAPSHOT/Workflow_Bundle_helloworld/1.0/lib/seqware-distribution-0.13.6-SNAPSHOT-full.jar --plugin net.sourceforge.seqware.pipeline.plugins.WorkflowLauncherV2 -- --help
Running Plugin: net.sourceforge.seqware.pipeline.plugins.WorkflowLauncherV2
Setting Up Plugin: net.sourceforge.seqware.pipeline.plugins.WorkflowLauncherV2@2fcac6db
Option                                  Description                                    
------                                  -----------                                    
-?, -h, --help                          Provides this help message.                    
-b, --bundle, --provisioned-bundle-dir  The path to a bundle zip file. You can         
                      specify this or the workflow-                
                      accession of an already installed            
                      bundle.                                      
--host                                  If specified, the scheduled workflow           
                      will only be launched if this                
                      parameter value and the host field           
                      in the workflow run table match.             
                      This is a mechanism to target                
                      workflows to particular servers for          
                      launching.                     
...
</code></pre>

<p>You can then test the workflow with:</p>

<pre><code>[seqware@seqwarevm maven-bundles]$ java -jar helloworld/target/Workflow_Bundle_helloworld_1.0_SeqWare_0.13.6-SNAPSHOT/Workflow_Bundle_helloworld/1.0/lib/seqware-distribution-0.13.6-SNAPSHOT-full.jar --plugin net.sourceforge.seqware.pipeline.plugins.WorkflowLauncherV2 -- --provisioned-bundle-dir /home/seqware/SeqWare/maven-bundles/helloworld/target/Workflow_Bundle_helloworld_1.0_SeqWare_0.13.6-SNAPSHOT --workflow helloworld --version 1.0 --ini-files helloworld/target/Workflow_Bundle_helloworld_1.0_SeqWare_0.13.6-SNAPSHOT/Workflow_Bundle_helloworld/1.0/config/workflow.ini --wait
Running Plugin: net.sourceforge.seqware.pipeline.plugins.WorkflowLauncherV2
Setting Up Plugin: net.sourceforge.seqware.pipeline.plugins.WorkflowLauncherV2@4d865b28
  INI FILE: helloworld/target/Workflow_Bundle_helloworld_1.0_SeqWare_0.13.6-SNAPSHOT/Workflow_Bundle_helloworld/1.0/config/workflow.ini
CREATING DAX IN: /tmp/dax5419643624422120164178112195381539
SUBMITTING TO PEGASUS: pegasus-plan -Dpegasus.user.properties=/home/seqware/.seqware/pegasus/properties --dax /tmp/dax5419643624422120164178112195381539 --dir /home/seqware/SeqWare/pegasus-dax -o seqwarevm --force --submit -s seqwarevm
PEGASUS STATUS COMMAND: pegasus-status -l /home/seqware/SeqWare/pegasus-dax/seqware/pegasus/helloworld/run0002
MONITORING PEGASUS STATUS:
RUNNING: step 1 of 7 (14%)
RUNNING: step 2 of 7 (28%)
RUNNING: step 3 of 7 (42%)
RUNNING: step 4 of 7 (57%)
RUNNING: step 5 of 7 (71%)
RUNNING: step 6 of 7 (85%)
WORKFLOW COMPLETED SUCCESSFULLY!
You have new mail in /var/spool/mail/seqware
[seqware@seqwarevm maven-bundles]$
</code></pre>

<p>This ends the tutorial on creating new workflows using Maven archetypes.
The next step is to look at examples of workflows at <a href="../15-workflow-examples/">Workflow Examples</a>.</p>
</div>
</div>
<p></p>
<div id="disqus_thread"></div>
</div>
</div>
<!-- ***** footer ***** -->
<div id="footer">
<p>SeqWare © 2007–2013 Brian O&#8217;Connor. SeqWare is released under the a <a rel="license" href="http://www.gnu.org/licenses/licenses.html">GNU GPL v3</a>. This site is built using the excellent <a href="http://nanoc.stoneship.org/">nanoc</a> tool and example site along with the <a href="http://www.fonts.info/info/press/free-fonts-for-font-face-embedding.htm">Graublau</a> and <a href="http://scripts.sil.org/Gentium">Gentium</a> fonts.</p>
</div>
</body>
</html>
